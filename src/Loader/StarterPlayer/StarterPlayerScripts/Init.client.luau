--!nocheck
--[[
	================================================================================
	SCRIPT: Init (Cliente)
	================================================================================
	
	Descri√ß√£o:
		Script de inicializa√ß√£o do lado do Cliente (LocalScript).
		Respons√°vel por carregar m√≥dulos do sistema e configurar o personagem inicial.
	
	Localiza√ß√£o:
		StarterPlayerScripts/Init
	
	Funcionalidades:
		- Carrega m√≥dulos em ReplicatedStorage/Modules/Systems.
		- Desabilita estados indesejados do Humanoid (Escalar, Pular).
		- Detecta tipo de dispositivo (Mobile/PC) e informa o servidor.
	
	Autor: Sistema ABH
	================================================================================
]]

--// ============================================================================
--// SETOR: Servi√ßos
--// ============================================================================

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")

--// ============================================================================
--// SETOR: Constantes e Refer√™ncias
--// ============================================================================

local MODULES_FOLDER = ReplicatedStorage:WaitForChild("Modules"):WaitForChild("Systems")
local NETWORK_FOLDER = ReplicatedStorage:WaitForChild("Network")
local PLAYER_DATA_FOLDER = NETWORK_FOLDER:WaitForChild("PlayerData")

local localPlayer = Players.LocalPlayer

--// ============================================================================
--// SETOR: Carregamento de M√≥dulos
--// ============================================================================

-- Itera e carrega todos os ModuleScripts na pasta de sistemas
for _, module in MODULES_FOLDER:GetChildren() do
	if module:IsA("ModuleScript") then
		require(module)
	end
end

--// ============================================================================
--// SETOR: Inicializa√ß√£o de UI para Officials (AntiHack)
--// ============================================================================

-- Carrega UI de alertas anti-hack (funciona para todos, mas s√≥ Officials recebem alertas)
local AntiHackUI = require(ReplicatedStorage:WaitForChild("Modules"):WaitForChild("Implementation"):WaitForChild("AntiHackUI"))
AntiHackUI:Init()

--// ============================================================================
--// SETOR: Fun√ß√µes Auxiliares
--// ============================================================================

--[[
	Configura o personagem quando ele √© adicionado.
	Desabilita estados de movimento n√£o desejados para este jogo.
	
	@param character Model - O modelo do personagem do jogador
]]
local function onCharacterAdded(character: Model)
	local humanoid = character:WaitForChild("Humanoid") :: Humanoid

	-- Desabilita escalada e pulo (pulo √© controlado pelo Stamina system)
	humanoid:SetStateEnabled(Enum.HumanoidStateType.Climbing, false)
	humanoid:SetStateEnabled(Enum.HumanoidStateType.Jumping, false)
end

--[[
	Detecta o dispositivo do jogador e envia para o servidor.
	Utilizado para exibir √≠cone correspondente (Celular/PC).
]]
local function detectAndSendDevice()
	local isMobile = UserInputService.TouchEnabled and not UserInputService.MouseEnabled
	local deviceEmoji = if isMobile then "üì±" else "üñ•Ô∏è"

	-- Tenta encontrar o evento remoto, aguardando se necess√°rio
	local setDevice = PLAYER_DATA_FOLDER:FindFirstChild("SetDevice")
	if not setDevice then
		setDevice = PLAYER_DATA_FOLDER:WaitForChild("SetDevice", 10)
	end

	if setDevice and setDevice:IsA("RemoteEvent") then
		setDevice:FireServer(deviceEmoji)
	end
end

--// ============================================================================
--// SETOR: Inicializa√ß√£o
--// ============================================================================

-- Detec√ß√£o de dispositivo em thread separada para n√£o bloquear
task.spawn(detectAndSendDevice)

-- Configura√ß√£o do personagem (atual e futuros)
local character = localPlayer.Character or localPlayer.CharacterAdded:Wait()
coroutine.wrap(onCharacterAdded)(character)

localPlayer.CharacterAdded:Connect(onCharacterAdded)
